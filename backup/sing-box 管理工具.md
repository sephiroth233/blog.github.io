# sing-box 管理工具 - 完整功能介绍

这是一个功能强大的 **sing-box 服务器管理脚本**，提供了完整的安装、配置、节点管理和中转功能。

项目地址：https://github.com/sephiroth233/sys-toolkit

---

## 📥 下载和安装方式

### 方式一：直接执行（推荐）
```bash
bash <(curl -fsSL sing-box-ebon.vercel.app)
```

### 方式二：保存后执行
```bash
curl -fsSL sing-box-ebon.vercel.app -o sing-box.sh && bash sing-box.sh
```

---

## 🎯 主要功能模块

### 1️⃣ **服务安装与卸载**
- **安装 sing-box**：自动下载并安装 sing-box 服务
    - 自动生成随机端口（避免冲突）
    - 自动生成密钥对（Reality、UUID等）
    - 自动生成自签名证书
    - 自动获取服务器 IP 和所在国家

- **卸载 sing-box**：完全删除服务和配置文件

### 2️⃣ **服务管理**
- 启动/停止/重启服务
- 查看服务运行状态
- 实时查看服务日志（journalctl）

### 3️⃣ **节点配置生成** ⭐
支持生成多种协议的入站配置：

| 协议 | 特点 |
|------|------|
| **Hysteria2** | 高性能，基于 UDP |
| **Shadowsocks + ShadowTLS** | 流量伪装能力强 |
| **VLESS + Vision + Reality** | 防审查，TLS 指纹识别 |
| **AnyTLS** | 通用 TLS 代理 |

**功能特性：**
- 支持单独或批量生成协议
- 自动检测端口可用性
- 支持用户自定义端口
- 生成完整的分享链接（URI 格式）

### 4️⃣ **客户端配置查看**
- 自动解析 config.json 中的协议配置
- 生成标准的 URI 分享链接
- 支持选择性查看特定协议

### 5️⃣ **中转配置管理** 🔀
- **添加中转**：配置本地端口 → 远程地址转发
- **查看中转**：列出所有活跃的中转配置
- **删除中转**：移除指定端口的中转规则

### 6️⃣ **BBR 加速**
- 启用 BBR：自动检测内核版本，启用 TCP BBR 拥塞控制
- 关闭 BBR：恢复默认配置
- 自动检测 BBR 启用状态

---

## 🔧 工作流程示例

### 完整使用流程：

```bash
# 1. 下载并执行脚本
bash <(curl -fsSL sing-box-ebon.vercel.app)

# 2. 选择菜单选项
# ├─ 选项 1：安装 sing-box 服务
# │  ├─ 自动下载安装
# │  ├─ 生成随机端口和密钥
# │  └─ 启动服务
#
# ├─ 选项 7：生成节点配置
# │  ├─ 选择协议类型（可多选）
# │  ├─ 输入或随机分配端口
# │  └─ 更新配置文件
#
# ├─ 选项 8：查看节点配置
# │  ├─ 解析 config.json
# │  └─ 生成客户端分享链接
#
# └─ 选项 10-12：中转配置管理
```

---

## 📊 配置文件说明

| 文件位置 | 作用 |
|---------|------|
| `/etc/sing-box/config.json` | 主配置文件（inbounds）|
| `/etc/sing-box/install_params.conf` | 安装参数备份（密钥、UUID等）|
| `/etc/sing-box/cert.pem` | TLS 证书 |
| `/etc/sing-box/private.key` | TLS 私钥 |

---

## 🎨 特色功能

### ✅ 智能端口管理
- 自动检测端口占用状态（`ss` 命令）
- 生成随机未使用端口（避免冲突）
- 支持用户自定义端口

### ✅ 依赖自动安装
脚本会自动安装所需的工具：
- **ss**（iproute2）- 端口检测
- **jq** - JSON 处理
- 支持多种包管理器（apt、yum、dnf、pacman、zypper）

### ✅ 错误恢复机制
- 配置修改前自动备份
- 失败后自动回滚
- JSON 格式验证

### ✅ 彩色输出
用不同颜色显示不同信息：
- 🟢 绿色：成功提示
- 🔴 红色：错误警告
- 🟡 黄色：重要提示
- 🔵 蓝色/紫色：分类标题

---

## 📋 菜单选项速查表

```
1.  安装 sing-box 服务
2.  卸载 sing-box 服务
3.  启动/停止 sing-box 服务
4.  重启 sing-box 服务
5.  查看服务状态
6.  查看实时日志
7.  生成节点配置 ⭐
8.  查看节点配置 ⭐
9.  删除节点配置
10. 添加中转配置
11. 查看中转配置
12. 删除中转配置
13. 启用/关闭 BBR 加速
0.  退出程序
```

---

## 🚀 使用建议

1. **首次使用**：执行脚本 → 选项 1 安装 → 选项 7 生成配置
2. **配置多个协议**：选项 7 时选择"全部"或多个协议编号
3. **获取分享链接**：选项 8 查看已生成的 URI 链接
4. **性能优化**：选项 13 启用 BBR 加速
5. **定期备份**：重要配置保存 `install_params.conf`

---

## ⚠️ 前置要求

- Linux 服务器（支持 systemd）
- Root 权限
- 网络连接（下载安装包）
- 支持的包管理器

---

这个脚本是一个**完整的 sing-box 管理解决方案**，特别适合需要快速部署多协议代理服务的用户！ 🎯